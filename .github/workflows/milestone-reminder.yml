name: Milestone Reminder
on:
  schedule:
    - cron: "0 17 * * *"  # Daily at 17:00 UTC (9am PST / 12pm EST)
  workflow_dispatch:  # Allow manual trigger for testing
permissions:
  issues: write
  contents: read
jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Check milestones and remind on open issues
        uses: actions/github-script@v7
        with:
          script: |
            const { data: milestones } = await github.rest.issues.listMilestones({
              ...context.repo,
              state: 'open'
            });
            
            const now = new Date();
            
            for (const m of milestones) {
              if (!m.due_on) continue;
              
              const due = new Date(m.due_on);
              const diffH = (due - now) / 36e5;  // hours until due
              
              // If between 0-48 hours until due, remind
              if (diffH > 0 && diffH < 48) {
                const { data: issues } = await github.rest.issues.listForRepo({
                  ...context.repo,
                  state: 'open',
                  milestone: m.number
                });
                
                for (const it of issues) {
                  await github.rest.issues.createComment({
                    ...context.repo,
                    issue_number: it.number,
                    body: `⏰ **Milestone reminder:** "${m.title}" is due soon (${m.due_on}).\n\nPlease confirm scope or move this item to a later milestone.`
                  });
                }
              }
            }

