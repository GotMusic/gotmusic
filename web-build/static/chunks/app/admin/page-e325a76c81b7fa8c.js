(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3698],{3552:(e,t,s)=>{"use strict";s.d(t,{Qx:()=>x,dU:()=>h,I0:()=>b,zC:()=>p});var a=s(7736),r=s(4869),n=s(7790),i=s(6771);let l=i.Ikc({id:i.YjP(),title:i.YjP(),artist:i.YjP(),bpm:i.aig().nullable(),keySig:i.YjP().nullable(),priceAmount:i.aig(),priceCurrency:i.YjP(),status:i.k5n(["draft","published","archived","processing","ready","error"]),updatedAt:i.aig(),createdAt:i.aig()}),c=i.Ikc({items:i.YOg(l),nextCursor:i.YjP().nullable()});async function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;e.limit&&t.set("limit",e.limit.toString()),e.cursor&&t.set("cursor",e.cursor),e.status&&t.set("status",e.status),e.q&&t.set("q",e.q);let s="".concat("","/api/assets?").concat(t.toString()),a=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json"}});if(!a.ok)throw Error("Failed to fetch assets: ".concat(a.statusText));let r=await a.json();return c.parse(r)}async function d(e){let t="".concat("","/api/assets/").concat(e),s=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok){if(404===s.status)throw Error("Asset not found: ".concat(e));throw Error("Failed to fetch asset: ".concat(s.statusText))}let a=await s.json();return l.parse(a)}async function u(e,t,s){let a="".concat("","/api/assets/").concat(e),r=await fetch(a,{method:"PATCH",headers:{"Content-Type":"application/json","Idempotency-Key":s},body:JSON.stringify(t)});if(!r.ok){if(404===r.status)throw Error("Asset not found: ".concat(e));if(422===r.status){let e=await r.json();throw Error("Validation failed: ".concat(JSON.stringify(e.details||e.error)))}throw Error("Failed to update asset: ".concat(r.statusText))}let n=await r.json();return l.parse(n)}async function m(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ready",s=arguments.length>2?arguments[2]:void 0,a=await fetch("".concat("","/api/upload/complete"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({assetId:e,status:t,errorMessage:s})});if(!a.ok){if(404===a.status)throw Error("Asset not found: ".concat(e));throw Error("Failed to complete asset processing: ".concat(a.statusText))}return a.json()}function h(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return(0,a.useQuery)({queryKey:["assets",e],queryFn:()=>o(e),...t})}function x(e,t){return(0,a.useQuery)({queryKey:["asset",e],queryFn:()=>d(e),enabled:!!e,...t})}function p(e){let t=(0,r.useQueryClient)();return(0,n.useMutation)({mutationFn:e=>{let{id:t,updates:s,idempotencyKey:a}=e;return u(t,s,a)},onSuccess:(e,s)=>{t.invalidateQueries({queryKey:["asset",s.id]}),t.invalidateQueries({queryKey:["assets"]})},...e})}function b(e){let t=(0,r.useQueryClient)();return(0,n.useMutation)({mutationFn:e=>{let{assetId:t,status:s,errorMessage:a}=e;return m(t,s,a)},onSuccess:(e,s)=>{t.invalidateQueries({queryKey:["asset",s.assetId]}),t.invalidateQueries({queryKey:["assets"]})},...e})}},9218:(e,t,s)=>{"use strict";s.d(t,{AdminAssetsTable:()=>m});var a=s(4568),r=s(3552),n=s(9664),i=s.n(n),l=s(7541),c=s(7620);let o=[{value:"",label:"All Status"},{value:"draft",label:"Draft"},{value:"published",label:"Published"},{value:"archived",label:"Archived"},{value:"processing",label:"Processing"},{value:"ready",label:"Ready"},{value:"error",label:"Error"}];function d(){var e,t;let s=(0,l.useRouter)(),r=(0,l.useSearchParams)(),[n,i]=(0,c.useTransition)(),[d,u]=(0,c.useState)(null!=(e=r.get("q"))?e:""),m=function(e,t){let s=(0,c.useRef)(null),a=(0,c.useRef)(e);return(0,c.useEffect)(()=>{a.current=e},[e]),(0,c.useEffect)(()=>()=>{s.current&&clearTimeout(s.current)},[]),(0,c.useCallback)(function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];s.current&&clearTimeout(s.current),s.current=setTimeout(()=>{a.current(...r)},t)},[t])}(e=>{let t=new URLSearchParams(r.toString());e?t.set("q",e):t.delete("q"),t.delete("cursor"),i(()=>{s.push("/admin?".concat(t.toString()))})},300),h=(0,c.useCallback)(e=>{u(e),m(e)},[m]),x=(0,c.useCallback)(e=>{let t=new URLSearchParams(r.toString());e?t.set("status",e):t.delete("status"),t.delete("cursor"),i(()=>{s.push("/admin?".concat(t.toString()))})},[s,r]),p=(0,c.useCallback)(()=>{u(""),i(()=>{s.push("/admin")})},[s]),b=r.get("q")||r.get("status");return(0,a.jsxs)("div",{className:"mt-6 flex flex-wrap items-center gap-3",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-[240px]",children:[(0,a.jsx)("label",{htmlFor:"asset-search",className:"sr-only",children:"Search assets"}),(0,a.jsx)("input",{id:"asset-search",type:"search",placeholder:"Search by title or artist...",value:d,onChange:e=>h(e.target.value),className:"w-full rounded-md border border-white/10 bg-white/5 px-3 py-2 text-sm text-fg placeholder:text-fg/50 focus:border-brand-accent focus:outline-none focus:ring-1 focus:ring-brand-accent","aria-label":"Search assets"})]}),(0,a.jsxs)("div",{className:"min-w-[160px]",children:[(0,a.jsx)("label",{htmlFor:"status-filter",className:"sr-only",children:"Filter by status"}),(0,a.jsx)("select",{id:"status-filter",value:null!=(t=r.get("status"))?t:"",onChange:e=>x(e.target.value),className:"w-full rounded-md border border-white/10 bg-white/5 px-3 py-2 text-sm text-fg focus:border-brand-accent focus:outline-none focus:ring-1 focus:ring-brand-accent","aria-label":"Filter assets by status",children:o.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))})]}),b&&(0,a.jsx)("button",{type:"button",onClick:p,className:"rounded-md border border-white/10 px-3 py-2 text-sm text-fg hover:bg-white/5","aria-label":"Clear all filters",children:"Clear Filters"}),n&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-fg/70",children:[(0,a.jsx)("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-fg/20 border-t-fg/70"}),(0,a.jsx)("span",{children:"Loading..."})]})]})}function u(e){let{nextCursor:t,hasPrevious:s}=e,r=(0,l.useRouter)(),n=(0,l.useSearchParams)(),[i,o]=(0,c.useTransition)(),d=(0,c.useCallback)(()=>{if(!t)return;let e=new URLSearchParams(n.toString());e.set("cursor",t),o(()=>{r.push("/admin?".concat(e.toString()))})},[t,r,n]),u=(0,c.useCallback)(()=>{let e=new URLSearchParams(n.toString());e.delete("cursor"),o(()=>{r.push("/admin?".concat(e.toString()))})},[r,n]);return s||t?(0,a.jsxs)("div",{className:"mt-4 flex items-center justify-between border-t border-white/10 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:u,disabled:!s||i,className:"rounded-md border border-white/10 px-4 py-2 text-sm font-medium text-fg hover:bg-white/5 disabled:cursor-not-allowed disabled:opacity-50","aria-label":"Previous page",children:"← Previous"}),(0,a.jsx)("button",{type:"button",onClick:d,disabled:!t||i,className:"rounded-md border border-white/10 px-4 py-2 text-sm font-medium text-fg hover:bg-white/5 disabled:cursor-not-allowed disabled:opacity-50","aria-label":"Next page",children:"Next →"})]}):null}function m(){var e;let t=(0,l.useSearchParams)(),s=Number.parseInt(t.get("limit")||"10",10),n=t.get("cursor")||void 0,c=t.get("status")||void 0,o=t.get("q")||void 0,{data:m,isLoading:p,isError:b}=(0,r.dU)({limit:s,cursor:n,status:c,q:o}),f=null!=(e=null==m?void 0:m.items)?e:[];return p?(0,a.jsxs)("main",{id:"main-content",className:"min-h-dvh p-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold",children:"Assets"}),(0,a.jsx)("p",{className:"mt-1 text-fg/70",children:"Admin asset management"}),(0,a.jsxs)("div",{className:"mt-6 space-y-3","aria-busy":"true","aria-live":"polite",children:[(0,a.jsx)("div",{className:"h-16 animate-pulse rounded-md border border-white/10 bg-white/5","aria-hidden":"true"}),(0,a.jsx)("div",{className:"h-16 animate-pulse rounded-md border border-white/10 bg-white/5","aria-hidden":"true"}),(0,a.jsx)("div",{className:"h-16 animate-pulse rounded-md border border-white/10 bg-white/5","aria-hidden":"true"}),(0,a.jsx)("div",{className:"h-16 animate-pulse rounded-md border border-white/10 bg-white/5","aria-hidden":"true"}),(0,a.jsx)("div",{className:"h-16 animate-pulse rounded-md border border-white/10 bg-white/5","aria-hidden":"true"}),(0,a.jsx)("span",{className:"sr-only",children:"Loading assets..."})]})]}):b?(0,a.jsx)(h,{}):(0,a.jsxs)("main",{id:"main-content",className:"min-h-dvh p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold",children:"Assets"}),(0,a.jsx)("p",{className:"mt-1 text-fg/70",children:"Admin asset management"})]}),(0,a.jsx)(i(),{href:"/admin/uploads",className:"rounded-md bg-brand-primary px-4 py-2 text-sm font-medium text-bg hover:opacity-95","aria-label":"Upload new asset",children:"Upload New"})]}),(0,a.jsx)(d,{}),(0,a.jsx)("div",{className:"mt-6 overflow-hidden rounded-md border border-white/10",children:(0,a.jsxs)("table",{className:"w-full","aria-label":"Assets table",children:[(0,a.jsx)("thead",{className:"border-b border-white/10 bg-white/5",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{scope:"col",className:"px-4 py-3 text-left text-sm font-medium text-fg",children:"Title"}),(0,a.jsx)("th",{scope:"col",className:"px-4 py-3 text-left text-sm font-medium text-fg",children:"Artist"}),(0,a.jsx)("th",{scope:"col",className:"px-4 py-3 text-left text-sm font-medium text-fg",children:"Details"}),(0,a.jsx)("th",{scope:"col",className:"px-4 py-3 text-left text-sm font-medium text-fg",children:"Price"}),(0,a.jsx)("th",{scope:"col",className:"px-4 py-3 text-left text-sm font-medium text-fg",children:"Status"}),(0,a.jsx)("th",{scope:"col",className:"px-4 py-3 text-left text-sm font-medium text-fg",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-white/10",children:0===f.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:6,className:"px-4 py-8 text-center text-fg/70",children:o||c?"No assets match your filters. Try adjusting your search.":"No assets found. Upload one to get started."})}):f.map(e=>{var t;return(0,a.jsxs)("tr",{className:"hover:bg-white/5",children:[(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)(i(),{href:"/admin/assets/".concat(e.id),className:"font-medium text-fg hover:text-brand-accent",children:e.title})}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-fg/70",children:e.artist}),(0,a.jsxs)("td",{className:"px-4 py-3 text-sm text-fg/70",children:[e.bpm?"".concat(e.bpm," BPM"):"—"," \xb7 ",null!=(t=e.keySig)?t:"—"]}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-fg",children:function(e,t,s){let a=navigator.language||"en-US";if(["PYUSD","ETH","BTC","USDC","USDT"].includes(t.toUpperCase())){let s=new Intl.NumberFormat(a,{minimumFractionDigits:2,maximumFractionDigits:2});return"".concat(t.toUpperCase()," ").concat(s.format(e))}try{return new Intl.NumberFormat(a,{style:"currency",currency:t,minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}catch(r){console.warn("Invalid currency code: ".concat(t,", falling back to plain format"));let s=new Intl.NumberFormat(a,{minimumFractionDigits:2,maximumFractionDigits:2});return"".concat(s.format(e)," ").concat(t)}}(e.priceAmount,e.priceCurrency)}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)(x,{status:e.status})}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)(i(),{href:"/admin/assets/".concat(e.id),className:"text-sm text-brand-accent hover:underline",children:"View"})})]},e.id)})})]})}),(0,a.jsx)(u,{nextCursor:(null==m?void 0:m.nextCursor)||null,hasPrevious:!!n})]})}function h(){return(0,a.jsxs)("main",{className:"min-h-dvh p-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold",children:"Assets"}),(0,a.jsx)("p",{className:"mt-1 text-fg/70",children:"Admin asset management"}),(0,a.jsxs)("div",{className:"mt-6 rounded-md border border-danger/20 bg-danger/10 p-4",children:[(0,a.jsx)("p",{className:"font-medium text-danger",children:"Failed to load assets"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-fg/70",children:"Please try refreshing the page or check your connection."})]})]})}function x(e){var t;let{status:s}=e,r=null!=(t=({ready:"bg-success/20 text-success border-success/30",processing:"bg-warning/20 text-warning border-warning/30",error:"bg-danger/20 text-danger border-danger/30",draft:"bg-white/10 text-fg border-white/20",published:"bg-brand-accent/20 text-brand-accent border-brand-accent/30",archived:"bg-white/5 text-fg/50 border-white/10"})[s])?t:"bg-white/10 text-fg border-white/20";return(0,a.jsx)("span",{className:"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-medium ".concat(r),children:s})}},9263:(e,t,s)=>{Promise.resolve().then(s.bind(s,9218))}},e=>{e.O(0,[1682,9664,1583,2023,587,18,7358],()=>e(e.s=9263)),_N_E=e.O()}]);