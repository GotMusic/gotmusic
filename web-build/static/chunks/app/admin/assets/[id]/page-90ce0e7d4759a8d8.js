(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9448],{3352:(e,t,s)=>{"use strict";s.d(t,{default:()=>l});var r=s(4568);let a=s(459).env.NEXT_PUBLIC_BLOCKSCOUT_URL||"https://base-sepolia.blockscout.com";function n(e){let{hash:t,type:s,children:n,showFullHash:i=!1,className:o=""}=e;if(!t)return null;let d="tx"===s?function(e){if(!e)return"";let t=e.startsWith("0x")?e:"0x".concat(e);return"".concat(a,"/tx/").concat(t)}(t):function(e){if(!e)return"";let t=e.startsWith("0x")?e:"0x".concat(e);return"".concat(a,"/search?q=").concat(t)}(t),l=n||(i?t:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4;if(!e)return"";if(e.length<=t+s+2)return e;let r=e.slice(0,2+t),a=e.slice(-s);return"".concat(r,"...").concat(a)}(t));return(0,r.jsxs)("a",{href:d,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-brand-500 hover:text-brand-600 hover:underline ".concat(o),"data-testid":"blockscout-link-".concat(s),children:[l,(0,r.jsx)("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),(0,r.jsx)("span",{className:"sr-only",children:"(opens in new tab)"})]})}function i(e){let{txHash:t,children:s,...a}=e;return(0,r.jsx)(n,{hash:t,type:"tx",...a,children:s||"View Transaction"})}function o(e){let{uid:t,children:s,...a}=e;return(0,r.jsx)(n,{hash:t,type:"attestation",...a,children:s||"View Attestation"})}var d=s(459);function l(e){let{assetId:t}=e,s="true"===d.env.NEXT_PUBLIC_SHOW_MOCK_RECEIPT;return s?(0,r.jsxs)("div",{className:"rounded-md border border-fg/10 bg-bg p-4","data-testid":"asset-receipt",children:[(0,r.jsxs)("div",{className:"mb-3 flex items-center justify-between",children:[(0,r.jsx)("h2",{className:"text-sm font-semibold",children:"License Receipt"}),s&&(0,r.jsx)("span",{className:"rounded bg-brand-500/10 px-2 py-0.5 text-xs text-brand-500","data-testid":"mock-badge",children:"Mock Data"})]}),(0,r.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("dt",{className:"mb-1 text-fg/70",children:"Transaction"}),(0,r.jsx)("dd",{className:"font-mono text-xs","data-testid":"receipt-tx",children:(0,r.jsx)(i,{txHash:"0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef"})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("dt",{className:"mb-1 text-fg/70",children:"Attestation (EAS)"}),(0,r.jsx)("dd",{className:"font-mono text-xs","data-testid":"receipt-attestation",children:(0,r.jsx)(o,{uid:"0xabcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890"})})]}),(0,r.jsx)("div",{className:"mt-4 rounded bg-fg/5 p-3 text-xs text-fg/70",children:(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Note:"})," License receipts are immutable attestations stored on Base Sepolia via Ethereum Attestation Service (EAS). Click the links above to verify on Blockscout."]})})]})]}):null}},3552:(e,t,s)=>{"use strict";s.d(t,{Qx:()=>x,dU:()=>b,I0:()=>g,zC:()=>p});var r=s(7736),a=s(4869),n=s(7790),i=s(6771);let o=i.Ikc({id:i.YjP(),title:i.YjP(),artist:i.YjP(),bpm:i.aig().nullable(),keySig:i.YjP().nullable(),priceAmount:i.aig(),priceCurrency:i.YjP(),status:i.k5n(["draft","published","archived","processing","ready","error"]),updatedAt:i.aig(),createdAt:i.aig()}),d=i.Ikc({items:i.YOg(o),nextCursor:i.YjP().nullable()});async function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;e.limit&&t.set("limit",e.limit.toString()),e.cursor&&t.set("cursor",e.cursor),e.status&&t.set("status",e.status),e.q&&t.set("q",e.q);let s="".concat("","/api/assets?").concat(t.toString()),r=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw Error("Failed to fetch assets: ".concat(r.statusText));let a=await r.json();return d.parse(a)}async function c(e){let t="".concat("","/api/assets/").concat(e),s=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok){if(404===s.status)throw Error("Asset not found: ".concat(e));throw Error("Failed to fetch asset: ".concat(s.statusText))}let r=await s.json();return o.parse(r)}async function u(e,t,s){let r="".concat("","/api/assets/").concat(e),a=await fetch(r,{method:"PATCH",headers:{"Content-Type":"application/json","Idempotency-Key":s},body:JSON.stringify(t)});if(!a.ok){if(404===a.status)throw Error("Asset not found: ".concat(e));if(422===a.status){let e=await a.json();throw Error("Validation failed: ".concat(JSON.stringify(e.details||e.error)))}throw Error("Failed to update asset: ".concat(a.statusText))}let n=await a.json();return o.parse(n)}async function m(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ready",s=arguments.length>2?arguments[2]:void 0,r=await fetch("".concat("","/api/upload/complete"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({assetId:e,status:t,errorMessage:s})});if(!r.ok){if(404===r.status)throw Error("Asset not found: ".concat(e));throw Error("Failed to complete asset processing: ".concat(r.statusText))}return r.json()}function b(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return(0,r.useQuery)({queryKey:["assets",e],queryFn:()=>l(e),...t})}function x(e,t){return(0,r.useQuery)({queryKey:["asset",e],queryFn:()=>c(e),enabled:!!e,...t})}function p(e){let t=(0,a.useQueryClient)();return(0,n.useMutation)({mutationFn:e=>{let{id:t,updates:s,idempotencyKey:r}=e;return u(t,s,r)},onSuccess:(e,s)=>{t.invalidateQueries({queryKey:["asset",s.id]}),t.invalidateQueries({queryKey:["assets"]})},...e})}function g(e){let t=(0,a.useQueryClient)();return(0,n.useMutation)({mutationFn:e=>{let{assetId:t,status:s,errorMessage:r}=e;return m(t,s,r)},onSuccess:(e,s)=>{t.invalidateQueries({queryKey:["asset",s.assetId]}),t.invalidateQueries({queryKey:["assets"]})},...e})}},5803:(e,t,s)=>{"use strict";s.d(t,{default:()=>i});var r=s(4568),a=s(3552),n=s(7620);function i(e){let{assetId:t,status:s}=e,[i,o]=(0,n.useState)(null),[d,l]=(0,n.useState)(!1),[c,u]=(0,n.useState)(null),m=(0,a.I0)({onSuccess:e=>{u(null)},onError:e=>{u(e.message)}});async function b(){l(!0),u(null),o(null);try{let e=await fetch("/api/assets/".concat(t,"/download"));if(!e.ok)throw Error("HTTP ".concat(e.status));let s=await e.json();if(!s.url)throw Error(s.message||"No URL returned (stubbed)");o(s.url)}catch(e){u(e instanceof Error?e.message:"error")}finally{l(!1)}}async function x(){i&&await navigator.clipboard.writeText(i)}return(0,r.jsxs)("div",{className:"mt-2 space-y-2 text-sm",children:["processing"===s&&(0,r.jsxs)("div",{className:"space-y-2 rounded-md border border-warning/20 bg-warning/10 p-3",children:[(0,r.jsx)("div",{className:"text-warning font-medium",children:"Asset is processing"}),(0,r.jsx)("p",{className:"text-fg/70 text-xs",children:"Simulate processing completion (in production, this would be automatic):"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{type:"button",className:"rounded-md bg-success px-3 py-1.5 text-xs font-medium text-white disabled:opacity-50",onClick:function(){u(null),m.mutate({assetId:t,status:"ready"})},disabled:m.isPending,children:m.isPending?"Marking...":"Mark as Ready"}),(0,r.jsx)("button",{type:"button",className:"rounded-md bg-danger px-3 py-1.5 text-xs font-medium text-white disabled:opacity-50",onClick:function(){u(null),m.mutate({assetId:t,status:"error",errorMessage:"Manual error trigger"})},disabled:m.isPending,children:"Mark as Error"})]})]}),(0,r.jsx)("button",{type:"button",className:"inline-flex items-center rounded-md bg-[var(--color-brand-600)] px-3 py-2 text-xs font-medium text-white disabled:opacity-50",onClick:b,disabled:d||"processing"===s,children:d?"Generating…":"Generate download link"}),i?(0,r.jsxs)("div",{className:"rounded bg-white/5 p-2",children:[(0,r.jsx)("div",{className:"truncate",children:i}),(0,r.jsx)("button",{type:"button",className:"mt-1 underline",onClick:x,children:"Copy"})]}):null,c?(0,r.jsx)("div",{className:"text-red-400",children:c}):null,(0,r.jsx)("p",{className:"text-fg/70",children:"Note: route is stubbed; will return a short-lived signed URL later."})]})}},5825:(e,t,s)=>{"use strict";s.d(t,{default:()=>u});var r=s(4568),a=s(3552),n=s(7541),i=s(7620),o=s(3631),d=s(6771);let l={success:e=>{alert("✅ ".concat(e))},error:e=>{alert("❌ ".concat(e))}},c=d.Ikc({title:d.YjP().min(1,"Title is required").max(200,"Title too long"),artist:d.YjP().min(1,"Artist is required").max(200,"Artist name too long"),bpm:d.aig().int().positive("BPM must be positive").optional().or(d.euz("")),keySig:d.YjP().max(10,"Key signature too long").optional().or(d.euz("")),priceAmount:d.aig().positive("Price must be positive"),priceCurrency:d.YjP().length(3,"Currency must be 3 characters"),status:d.k5n(["draft","published","archived","processing","ready","error"])});function u(e){let{assetId:t}=e;(0,n.useRouter)();let{data:s,isLoading:d,error:u}=(0,a.Qx)(t),[m,b]=(0,i.useState)(!1),{register:x,handleSubmit:p,formState:{errors:g,isDirty:f},reset:h,watch:y}=(0,o.mN)({resolver:async e=>{let t=c.safeParse(e);if(t.success)return{values:t.data,errors:{}};let s=t.error.flatten(),r={};for(let[e,t]of Object.entries(s.fieldErrors))Array.isArray(t)&&t.length>0&&(r[e]={type:"validation",message:t[0]});return Array.isArray(s.formErrors)&&s.formErrors.length>0&&(r._root={type:"validation",message:s.formErrors[0]}),{values:{},errors:r}},defaultValues:{title:"",artist:"",bpm:void 0,keySig:"",priceAmount:0,priceCurrency:"USD",status:"ready"}});(0,i.useEffect)(()=>{if(s){var e,t;h({title:s.title,artist:s.artist,bpm:null!=(e=s.bpm)?e:void 0,keySig:null!=(t=s.keySig)?t:"",priceAmount:s.priceAmount,priceCurrency:s.priceCurrency,status:s.status})}},[s,h]);let j=(0,a.zC)({onSuccess:e=>{l.success("Asset updated successfully"),b(!1)},onError:e=>{l.error("Update failed: ".concat(e.message))}}),v=e=>{let s={title:e.title,artist:e.artist,priceAmount:e.priceAmount,priceCurrency:e.priceCurrency,status:e.status,...void 0!==e.bpm&&""!==e.bpm?{bpm:e.bpm}:{},...e.keySig&&""!==e.keySig?{keySig:e.keySig}:{}},r="edit-".concat(t,"-").concat(Date.now());j.mutate({id:t,updates:s,idempotencyKey:r})};return d?(0,r.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,r.jsx)("div",{className:"text-fg/70",children:"Loading asset..."})}):u?(0,r.jsx)("div",{className:"rounded-md border border-red-500/20 bg-red-500/10 p-4",children:(0,r.jsxs)("div",{className:"text-red-400",children:["Error loading asset: ",u.message]})}):s?(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold",children:"Asset Details"}),(0,r.jsx)("div",{className:"flex gap-2",children:m?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{type:"button",onClick:()=>{if(s){var e,t;h({title:s.title,artist:s.artist,bpm:null!=(e=s.bpm)?e:void 0,keySig:null!=(t=s.keySig)?t:"",priceAmount:s.priceAmount,priceCurrency:s.priceCurrency,status:s.status})}b(!1)},className:"rounded-md border border-fg/20 bg-transparent px-3 py-2 text-sm font-medium text-fg hover:bg-fg/5",disabled:j.isPending,children:"Cancel"}),(0,r.jsx)("button",{type:"button",onClick:p(v),disabled:!f||j.isPending,className:"rounded-md bg-brand-600 px-3 py-2 text-sm font-medium text-white hover:bg-brand-700 disabled:opacity-50",children:j.isPending?"Saving...":"Save Changes"})]}):(0,r.jsx)("button",{type:"button",onClick:()=>b(!0),className:"rounded-md bg-brand-600 px-3 py-2 text-sm font-medium text-white hover:bg-brand-700",children:"Edit"})})]}),(0,r.jsxs)("form",{onSubmit:p(v),className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"title",className:"block text-sm font-medium text-fg",children:"Title *"}),(0,r.jsx)("input",{...x("title"),type:"text",id:"title",disabled:!m,className:"mt-1 block w-full rounded-md border border-fg/20 bg-bg px-3 py-2 text-fg placeholder-fg/50 focus:border-brand-500 focus:outline-none focus:ring-1 focus:ring-brand-500 disabled:bg-fg/5 disabled:text-fg/70",placeholder:"Enter asset title"}),g.title&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-400",children:g.title.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"artist",className:"block text-sm font-medium text-fg",children:"Artist *"}),(0,r.jsx)("input",{...x("artist"),type:"text",id:"artist",disabled:!m,className:"mt-1 block w-full rounded-md border border-fg/20 bg-bg px-3 py-2 text-fg placeholder-fg/50 focus:border-brand-500 focus:outline-none focus:ring-1 focus:ring-brand-500 disabled:bg-fg/5 disabled:text-fg/70",placeholder:"Enter artist name"}),g.artist&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-400",children:g.artist.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"bpm",className:"block text-sm font-medium text-fg",children:"BPM"}),(0,r.jsx)("input",{...x("bpm",{valueAsNumber:!0}),type:"number",id:"bpm",disabled:!m,className:"mt-1 block w-full rounded-md border border-fg/20 bg-bg px-3 py-2 text-fg placeholder-fg/50 focus:border-brand-500 focus:outline-none focus:ring-1 focus:ring-brand-500 disabled:bg-fg/5 disabled:text-fg/70",placeholder:"120"}),g.bpm&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-400",children:g.bpm.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"keySig",className:"block text-sm font-medium text-fg",children:"Key Signature"}),(0,r.jsx)("input",{...x("keySig"),type:"text",id:"keySig",disabled:!m,className:"mt-1 block w-full rounded-md border border-fg/20 bg-bg px-3 py-2 text-fg placeholder-fg/50 focus:border-brand-500 focus:outline-none focus:ring-1 focus:ring-brand-500 disabled:bg-fg/5 disabled:text-fg/70",placeholder:"C Major"}),g.keySig&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-400",children:g.keySig.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"priceAmount",className:"block text-sm font-medium text-fg",children:"Price Amount *"}),(0,r.jsx)("input",{...x("priceAmount",{valueAsNumber:!0}),type:"number",step:"0.01",id:"priceAmount",disabled:!m,className:"mt-1 block w-full rounded-md border border-fg/20 bg-bg px-3 py-2 text-fg placeholder-fg/50 focus:border-brand-500 focus:outline-none focus:ring-1 focus:ring-brand-500 disabled:bg-fg/5 disabled:text-fg/70",placeholder:"29.99"}),g.priceAmount&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-400",children:g.priceAmount.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"priceCurrency",className:"block text-sm font-medium text-fg",children:"Currency *"}),(0,r.jsxs)("select",{...x("priceCurrency"),id:"priceCurrency",disabled:!m,className:"mt-1 block w-full rounded-md border border-fg/20 bg-bg px-3 py-2 text-fg focus:border-brand-500 focus:outline-none focus:ring-1 focus:ring-brand-500 disabled:bg-fg/5 disabled:text-fg/70",children:[(0,r.jsx)("option",{value:"USD",children:"USD"}),(0,r.jsx)("option",{value:"PYUSD",children:"PYUSD"}),(0,r.jsx)("option",{value:"ETH",children:"ETH"})]}),g.priceCurrency&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-400",children:g.priceCurrency.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"status",className:"block text-sm font-medium text-fg",children:"Status *"}),(0,r.jsxs)("select",{...x("status"),id:"status",disabled:!m,className:"mt-1 block w-full rounded-md border border-fg/20 bg-bg px-3 py-2 text-fg focus:border-brand-500 focus:outline-none focus:ring-1 focus:ring-brand-500 disabled:bg-fg/5 disabled:text-fg/70",children:[(0,r.jsx)("option",{value:"processing",children:"Processing"}),(0,r.jsx)("option",{value:"ready",children:"Ready"}),(0,r.jsx)("option",{value:"error",children:"Error"})]}),g.status&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-400",children:g.status.message})]})]}),j.isPending&&(0,r.jsx)("div",{className:"rounded-md border border-blue-500/20 bg-blue-500/10 p-3",children:(0,r.jsx)("div",{className:"text-blue-400",children:"Updating asset..."})}),j.error&&(0,r.jsx)("div",{className:"rounded-md border border-red-500/20 bg-red-500/10 p-3",children:(0,r.jsxs)("div",{className:"text-red-400",children:["Update failed: ",j.error.message]})})]})]}):(0,r.jsx)("div",{className:"rounded-md border border-red-500/20 bg-red-500/10 p-4",children:(0,r.jsx)("div",{className:"text-red-400",children:"Asset not found"})})}},7775:(e,t,s)=>{Promise.resolve().then(s.bind(s,5803)),Promise.resolve().then(s.bind(s,5825)),Promise.resolve().then(s.bind(s,3352))}},e=>{e.O(0,[1682,1583,2023,3631,587,18,7358],()=>e(e.s=7775)),_N_E=e.O()}]);