(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1751],{6114:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>o});var r=l(4568),n=l(7620),a=l(3530);function o(){let[e,t]=(0,n.useState)(null),[l,o]=(0,n.useState)(0),{state:s,error:i,busy:u,upload:d,reset:c}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[t,l]=(0,n.useState)("idle"),[r,a]=(0,n.useState)(null),o=(0,n.useRef)(null),s=(0,n.useCallback)(()=>{var e;null==(e=o.current)||e.abort(),o.current=null,l("idle"),a(null)},[]),i=(0,n.useCallback)(async t=>{try{a(null),l("signing");let r=await fetch("/api/upload/sign",{method:"POST",body:JSON.stringify({filename:t.name,contentType:t.type,fileSize:t.size})});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error(e.error||"Sign failed: ".concat(r.status))}let{url:n,key:s,contentType:i}=await r.json();l("uploading"),o.current=new AbortController;let u=new XMLHttpRequest,d=new Promise((t,r)=>{u.upload.onprogress=t=>{var l;if(!t.lengthComputable)return;let r=Math.floor(t.loaded/t.total*100);null==(l=e.onProgress)||l.call(e,r)},u.onload=()=>{var n,o;if(u.status>=200&&u.status<300)l("done"),t({ok:!0}),null==(n=e.onDone)||n.call(e,{ok:!0});else{let t=Error("upload failed: HTTP ".concat(u.status));l("error"),a(t.message),r(t),null==(o=e.onError)||o.call(e,t)}},u.onerror=()=>{var t;let n=Error("network error during upload");l("error"),a(n.message),r(n),null==(t=e.onError)||t.call(e,n)},u.onabort=()=>{var t;let n=Error("upload aborted");l("error"),a(n.message),r(n),null==(t=e.onError)||t.call(e,n)}});return u.open("PUT",n,!0),u.setRequestHeader("Content-Type",i),u.send(t),await d}catch(n){var r;l("error");let t=n instanceof Error?n:Error("upload error");throw a(t.message),null==(r=e.onError)||r.call(e,t),t}finally{o.current=null}},[e]),u="signing"===t||"uploading"===t;return(0,n.useMemo)(()=>({state:t,error:r,busy:u,upload:i,reset:s}),[t,r,u,i,s])}({onProgress:e=>o(e)});async function p(){e&&(o(0),await d(e))}return(0,r.jsxs)("main",{id:"main-content",className:"p-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-semibold","data-testid":"upload-heading",children:"Uploads"}),(0,r.jsxs)("div",{className:"mt-4 rounded-md border border-white/10 p-4",children:[(0,r.jsx)("input",{type:"file",accept:"audio/*",onChange:e=>{var l,r;return t(null!=(r=null==(l=e.target.files)?void 0:l[0])?r:null)},className:"block","data-testid":"file-input"}),(0,r.jsxs)("div",{className:"mt-3 flex items-center gap-2",children:[(0,r.jsx)(a.$n,{type:"button",onClick:p,disabled:!e||u,"data-testid":"upload-button",children:u?"Uploadingâ€¦":"Upload"}),(0,r.jsx)(a.$n,{type:"button",variant:"secondary",onClick:c,disabled:u,"data-testid":"reset-button",children:"Reset"}),u?(0,r.jsxs)("span",{className:"text-sm text-fg/70",children:[l,"%"]}):null]}),(0,r.jsxs)("div",{className:"mt-2 text-sm text-fg/70",children:["State: ",s," ",i?"â€” ".concat(i):""]})]})]})}},8675:(e,t,l)=>{Promise.resolve().then(l.bind(l,6114))}},e=>{e.O(0,[3106,3530,587,18,7358],()=>e(e.s=8675)),_N_E=e.O()}]);