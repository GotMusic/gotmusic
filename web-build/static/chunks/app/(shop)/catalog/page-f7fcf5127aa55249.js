(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3980],{3552:(e,t,r)=>{"use strict";r.d(t,{Qx:()=>h,dU:()=>p,I0:()=>m,zC:()=>f});var s=r(7736),a=r(4869),n=r(7790),o=r(6771);let i=o.Ikc({id:o.YjP(),title:o.YjP(),artist:o.YjP(),bpm:o.aig().nullable(),keySig:o.YjP().nullable(),priceAmount:o.aig(),priceCurrency:o.YjP(),status:o.k5n(["draft","published","archived","processing","ready","error"]),updatedAt:o.aig(),createdAt:o.aig()}),l=o.Ikc({items:o.YOg(i),nextCursor:o.YjP().nullable()});async function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;e.limit&&t.set("limit",e.limit.toString()),e.cursor&&t.set("cursor",e.cursor),e.status&&t.set("status",e.status),e.q&&t.set("q",e.q);let r="".concat("","/api/assets?").concat(t.toString()),s=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok)throw Error("Failed to fetch assets: ".concat(s.statusText));let a=await s.json();return l.parse(a)}async function u(e){let t="".concat("","/api/assets/").concat(e),r=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok){if(404===r.status)throw Error("Asset not found: ".concat(e));throw Error("Failed to fetch asset: ".concat(r.statusText))}let s=await r.json();return i.parse(s)}async function d(e,t,r){let s="".concat("","/api/assets/").concat(e),a=await fetch(s,{method:"PATCH",headers:{"Content-Type":"application/json","Idempotency-Key":r},body:JSON.stringify(t)});if(!a.ok){if(404===a.status)throw Error("Asset not found: ".concat(e));if(422===a.status){let e=await a.json();throw Error("Validation failed: ".concat(JSON.stringify(e.details||e.error)))}throw Error("Failed to update asset: ".concat(a.statusText))}let n=await a.json();return i.parse(n)}async function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ready",r=arguments.length>2?arguments[2]:void 0,s=await fetch("".concat("","/api/upload/complete"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({assetId:e,status:t,errorMessage:r})});if(!s.ok){if(404===s.status)throw Error("Asset not found: ".concat(e));throw Error("Failed to complete asset processing: ".concat(s.statusText))}return s.json()}function p(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return(0,s.useQuery)({queryKey:["assets",e],queryFn:()=>c(e),...t})}function h(e,t){return(0,s.useQuery)({queryKey:["asset",e],queryFn:()=>u(e),enabled:!!e,...t})}function f(e){let t=(0,a.useQueryClient)();return(0,n.useMutation)({mutationFn:e=>{let{id:t,updates:r,idempotencyKey:s}=e;return d(t,r,s)},onSuccess:(e,r)=>{t.invalidateQueries({queryKey:["asset",r.id]}),t.invalidateQueries({queryKey:["assets"]})},...e})}function m(e){let t=(0,a.useQueryClient)();return(0,n.useMutation)({mutationFn:e=>{let{assetId:t,status:r,errorMessage:s}=e;return g(t,r,s)},onSuccess:(e,r)=>{t.invalidateQueries({queryKey:["asset",r.assetId]}),t.invalidateQueries({queryKey:["assets"]})},...e})}},6613:(e,t,r)=>{Promise.resolve().then(r.bind(r,9593))},9593:(e,t,r)=>{"use strict";r.d(t,{CatalogGrid:()=>d});var s=r(4568),a=r(7620);let n=a.createContext(null);function o(e){let{children:t}=e,r=a.useRef(null),[o,i]=a.useState(null),[l,c]=a.useState(!1);a.useEffect(()=>{let e=new Audio;return e.preload="none",e.addEventListener("ended",()=>c(!1)),r.current=e,()=>{e.pause(),e.src=""}},[]);let u=a.useCallback((e,t)=>{let s=r.current;if(s){if(o===e&&!s.paused){s.pause(),c(!1);return}s.pause(),s.src=t,s.play().then(()=>{i(e),c(!0)}).catch(()=>{c(!1)})}},[o]),d=a.useMemo(()=>({currentId:o,isPlaying:l,toggle:u}),[o,l,u]);return(0,s.jsx)(n.Provider,{value:d,children:t})}var i=r(3552),l=r(3530),c=r(7541);function u(){let e=(0,c.useRouter)(),{data:t,isLoading:r,error:o}=(0,i.dU)({limit:24,status:"published"}),{currentId:u,isPlaying:d,toggle:g}=function(){let e=a.useContext(n);if(!e)throw Error("usePreview must be used within <PreviewProvider>");return e}();return r?(0,s.jsx)("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3",children:Array.from({length:6},(e,t)=>(0,s.jsx)("div",{className:"h-32 rounded-lg border border-[var(--border-subtle,rgba(255,255,255,0.10))] bg-[var(--color-bg-elevated,#121520)] animate-pulse","data-testid":"catalog-skeleton"},"skeleton-".concat(t)))}):o?(0,s.jsxs)("div",{className:"rounded-lg border border-[var(--border-danger,rgba(249,112,102,0.55))] bg-[var(--color-bg-elevated,#121520)] p-6 text-center",role:"alert",children:[(0,s.jsx)("p",{className:"text-[var(--color-semantic-danger,#F97066)]",children:"Failed to load catalog"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-[var(--color-fg-muted,#A9B1C1)]",children:o instanceof Error?o.message:"Unknown error"})]}):(null==t?void 0:t.items.length)?(0,s.jsx)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-3","data-testid":"catalog-grid",children:t.items.map(t=>{var r,a;return(0,s.jsx)(l.mz,{id:t.id,title:t.title,producer:t.artist||"Unknown",price:"$".concat((t.priceAmount/100).toFixed(2)),bpm:null!=(r=t.bpm)?r:void 0,keySig:null!=(a=t.keySig)?a:void 0,tags:[],artworkUrl:void 0,previewUrl:void 0,isPlaying:u===t.id&&d,onPreviewToggle:e=>{g(e,"")},onOpen:t=>e.push("/asset/".concat(t))},t.id)})}):(0,s.jsx)("div",{className:"rounded-lg border border-[var(--border-subtle,rgba(255,255,255,0.10))] bg-[var(--color-bg-elevated,#121520)] p-12 text-center",children:(0,s.jsx)("p",{className:"text-[var(--color-fg-muted,#A9B1C1)]",children:"No assets found"})})}function d(){return(0,s.jsx)(o,{children:(0,s.jsx)(u,{})})}}},e=>{e.O(0,[3106,1682,1583,2023,3530,587,18,7358],()=>e(e.s=6613)),_N_E=e.O()}]);