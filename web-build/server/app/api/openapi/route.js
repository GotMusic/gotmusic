(()=>{var a={};a.id=774,a.ids=[774],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},14216:(a,b,c)=>{"use strict";c.d(b,{h:()=>j});let d=()=>{},e={debug:d,info:d,warn:console.warn.bind(console),error:console.error.bind(console)},{debug:f,info:g,warn:h,error:i}=e;function j(a){let b="";if("string"==typeof a)b=`[${a}]`;else if(a&&"object"==typeof a){let c=[];a.requestId&&c.push(`req:${a.requestId}`),a.method&&c.push(a.method),a.path&&c.push(a.path),b=c.length>0?`[${c.join(" ")}]`:""}return{debug:(...a)=>e.debug(b,...a),info:(...a)=>e.info(b,...a),warn:(...a)=>e.warn(b,...a),error:(...a)=>e.error(b,...a)}}},19121:a=>{"use strict";a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},46683:(a,b,c)=>{"use strict";c.r(b),c.d(b,{handler:()=>D,patchFetch:()=>C,routeModule:()=>y,serverHooks:()=>B,workAsyncStorage:()=>z,workUnitAsyncStorage:()=>A});var d={};c.r(d),c.d(d,{GET:()=>x,runtime:()=>w});var e=c(26421),f=c(97714),g=c(85681),h=c(22369),i=c(37587),j=c(261),k=c(46537),l=c(3463),m=c(1889),n=c(85250),o=c(23620),p=c(29790),q=c(67876),r=c(57749),s=c(86439),t=c(40139),u=c(14216),v=c(53444);let w="nodejs";async function x(a){let b=(0,u.h)();b.info("OpenAPI spec requested");try{let a={openapi:"3.0.3",info:{title:"GotMusic API",description:"Music NFT marketplace API powered by Ethereum",version:"1.0.0",contact:{name:"GotMusic Team",url:"https://github.com/GotMusic/gotmusic"}},servers:[{url:"http://localhost:3000",description:"Development server"}],paths:{"/api/assets":{get:{summary:"List assets",description:"Get paginated list of assets with optional filtering",tags:["Assets"],parameters:[{name:"limit",in:"query",schema:{type:"integer",minimum:1,maximum:100,default:20},description:"Number of assets to return"},{name:"cursor",in:"query",schema:{type:"string"},description:"Cursor for pagination"},{name:"status",in:"query",schema:{type:"string",enum:["draft","published","archived","processing","ready","error"]},description:"Filter assets by status"},{name:"q",in:"query",schema:{type:"string",minLength:1,maxLength:200},description:"Search query to filter by title or artist (partial match)"}],responses:{200:{description:"List of assets with pagination",content:{"application/json":{schema:{type:"object",properties:{items:{type:"array",items:{$ref:"#/components/schemas/Asset"}},nextCursor:{type:"string",nullable:!0,description:"Cursor for next page (null if no more results)"}},required:["items","nextCursor"]}}},headers:{"X-Total-Count":{description:"Total number of assets (only when no filters applied)",schema:{type:"integer"}}}},400:{description:"Invalid query parameters",content:{"application/json":{schema:{type:"object",properties:{error:{type:"string"},details:{type:"object"}}}}}},500:{description:"Server error",content:{"application/json":{schema:{$ref:"#/components/schemas/ErrorResponse"}}}}}}},"/api/assets/{id}":{get:{summary:"Get asset by ID",description:"Retrieve a single asset by its ID",tags:["Assets"],parameters:[{name:"id",in:"path",required:!0,schema:{type:"string"},description:"Asset ID"}],responses:{200:{description:"Asset details",content:{"application/json":{schema:{$ref:"#/components/schemas/Asset"}}}},404:{description:"Asset not found",content:{"application/json":{schema:{$ref:"#/components/schemas/ErrorResponse"}}}},500:{description:"Server error",content:{"application/json":{schema:{$ref:"#/components/schemas/ErrorResponse"}}}}}},patch:{summary:"Update asset",description:"Update asset fields with idempotency support",tags:["Assets"],parameters:[{name:"id",in:"path",required:!0,schema:{type:"string"},description:"Asset ID"}],requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/UpdateAssetInput"}}}},responses:{200:{description:"Updated asset",content:{"application/json":{schema:{$ref:"#/components/schemas/Asset"}}}},400:{description:"Bad request",content:{"application/json":{schema:{$ref:"#/components/schemas/ErrorResponse"}}}},404:{description:"Asset not found",content:{"application/json":{schema:{$ref:"#/components/schemas/ErrorResponse"}}}},422:{description:"Validation error",content:{"application/json":{schema:{$ref:"#/components/schemas/ValidationErrorResponse"}}}},500:{description:"Server error",content:{"application/json":{schema:{$ref:"#/components/schemas/ErrorResponse"}}}}}}},"/api/assets/{id}/audit":{get:{summary:"Get asset audit log",description:"Retrieve audit log for an asset",tags:["Assets"],parameters:[{name:"id",in:"path",required:!0,schema:{type:"string"},description:"Asset ID"}],responses:{200:{description:"Asset audit log",content:{"application/json":{schema:{$ref:"#/components/schemas/AuditLogResponse"}}}},404:{description:"Asset not found",content:{"application/json":{schema:{$ref:"#/components/schemas/ErrorResponse"}}}},500:{description:"Server error",content:{"application/json":{schema:{$ref:"#/components/schemas/ErrorResponse"}}}}}}},"/api/assets/{id}/download":{get:{summary:"Get asset download URL",description:"Generate signed download URL for an asset",tags:["Assets"],parameters:[{name:"id",in:"path",required:!0,schema:{type:"string"},description:"Asset ID"}],responses:{200:{description:"Download URL",content:{"application/json":{schema:{type:"object",properties:{url:{type:"string",example:"https://cdn.example.com/asset.mp3"},ttlSeconds:{type:"number",example:3600}}}}}},404:{description:"Asset not found",content:{"application/json":{schema:{$ref:"#/components/schemas/ErrorResponse"}}}},500:{description:"Server error",content:{"application/json":{schema:{$ref:"#/components/schemas/ErrorResponse"}}}}}}},"/api/upload/sign":{post:{summary:"Request pre-signed upload URL",description:"Validates file size and type, then returns a pre-signed URL for direct upload to storage (R2/S3). Rate limited to 30 requests per minute per IP address.",tags:["Upload"],requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/UploadSignInput"}}}},responses:{200:{description:"Pre-signed URL generated",headers:{"X-RateLimit-Limit":{schema:{type:"integer",example:30},description:"Maximum requests allowed per window"},"X-RateLimit-Remaining":{schema:{type:"integer",example:29},description:"Requests remaining in current window"},"X-RateLimit-Reset":{schema:{type:"integer",example:1697472e6},description:"Unix timestamp (ms) when limit resets"}},content:{"application/json":{schema:{type:"object",properties:{url:{type:"string",example:"https://storage.example.com/..."},key:{type:"string",example:"assets/1234567890-abc123-test.mp3"},contentType:{type:"string",example:"audio/mpeg"}},required:["url","key","contentType"]}}}},429:{description:"Rate limit exceeded (30 requests/min)",headers:{"Retry-After":{schema:{type:"integer",example:45},description:"Seconds until limit resets"},"X-RateLimit-Limit":{schema:{type:"integer",example:30}},"X-RateLimit-Remaining":{schema:{type:"integer",example:0}},"X-RateLimit-Reset":{schema:{type:"integer",example:1697472e6}}},content:{"application/json":{schema:{type:"object",properties:{error:{type:"string",example:"Too many requests. Please try again later."},retryAfter:{type:"integer",example:45,description:"Seconds until retry"}},required:["error","retryAfter"]}}}},400:{description:"Validation failed (file too large, invalid type, or missing fields)",content:{"application/json":{schema:{$ref:"#/components/schemas/ValidationErrorResponse"}}}},500:{description:"Server error",content:{"application/json":{schema:{$ref:"#/components/schemas/ErrorResponse"}}}}}}},"/api/upload/notify":{post:{summary:"Notify upload completion",description:"Mark asset as processing after upload",tags:["Upload"],requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/UploadNotifyInput"}}}},responses:{200:{description:"Upload notification processed",content:{"application/json":{schema:{type:"object",properties:{ok:{type:"boolean",example:!0},fileId:{type:"string",example:"file-beat_001-original-1234567890"},assetId:{type:"string",example:"beat_001"},status:{type:"string",example:"processing"}}}}}},400:{description:"Bad request",content:{"application/json":{schema:{$ref:"#/components/schemas/ErrorResponse"}}}},404:{description:"Asset not found",content:{"application/json":{schema:{$ref:"#/components/schemas/ErrorResponse"}}}},500:{description:"Server error",content:{"application/json":{schema:{$ref:"#/components/schemas/ErrorResponse"}}}}}}},"/api/upload/complete":{post:{summary:"Complete asset processing",description:"Mark asset as ready or error after processing",tags:["Upload"],requestBody:{required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/UploadCompleteInput"}}}},responses:{200:{description:"Processing completion processed",content:{"application/json":{schema:{type:"object",properties:{ok:{type:"boolean",example:!0},assetId:{type:"string",example:"beat_001"},status:{type:"string",example:"ready"},message:{type:"string",example:"Asset processing complete"}}}}}},400:{description:"Bad request",content:{"application/json":{schema:{$ref:"#/components/schemas/ErrorResponse"}}}},404:{description:"Asset not found",content:{"application/json":{schema:{$ref:"#/components/schemas/ErrorResponse"}}}},500:{description:"Server error",content:{"application/json":{schema:{$ref:"#/components/schemas/ErrorResponse"}}}}}}},"/api/healthz":{get:{summary:"Health check",description:"Basic health check endpoint for load balancers",tags:["Health"],responses:{200:{description:"Service is healthy",content:{"application/json":{schema:{type:"object",properties:{status:{type:"string",example:"healthy"},timestamp:{type:"string",example:"2025-10-14T22:30:16.302Z"},service:{type:"string",example:"gotmusic-api"}},required:["status","timestamp","service"]}}}}}}},"/api/readiness":{get:{summary:"Readiness check",description:"Readiness check with database connectivity, migrations, and seed data verification. Used by CI/E2E tests and deployment health checks.",tags:["Health"],responses:{200:{description:"Service is ready",content:{"application/json":{schema:{type:"object",properties:{status:{type:"string",example:"ready"},timestamp:{type:"string",example:"2025-10-15T22:30:22.825Z"},service:{type:"string",example:"gotmusic-api"},checks:{type:"object",properties:{db_connected:{type:"boolean",example:!0},migrations_applied:{type:"boolean",example:!0},seed_data:{type:"boolean",example:!0}},required:["db_connected","migrations_applied","seed_data"]}},required:["status","timestamp","service","checks"]}}}},503:{description:"Service not ready",content:{"application/json":{schema:{type:"object",properties:{status:{type:"string",example:"not_ready"},timestamp:{type:"string",example:"2025-10-15T22:30:18.325Z"},service:{type:"string",example:"gotmusic-api"},checks:{type:"object",properties:{db_connected:{type:"boolean",example:!1},migrations_applied:{type:"boolean",example:!1},seed_data:{type:"boolean",example:!1}},required:["db_connected","migrations_applied","seed_data"]},errors:{type:"array",items:{type:"string"},example:["DB connection failed: connection refused"]}},required:["status","timestamp","service","checks","errors"]}}}}}}}},components:{schemas:{Asset:{type:"object",properties:{id:{type:"string",example:"beat_001"},title:{type:"string",example:"Night Drive 88"},artist:{type:"string",example:"KiloWav"},bpm:{type:"number",nullable:!0,example:88},keySig:{type:"string",nullable:!0,example:"Am"},priceAmount:{type:"number",example:12},priceCurrency:{type:"string",example:"PYUSD"},status:{type:"string",enum:["draft","published","archived","processing","ready","error"],example:"published"},createdAt:{type:"number",example:0x499602d2},updatedAt:{type:"number",example:0x499602d2}},required:["id","title","artist","priceAmount","priceCurrency","status","createdAt","updatedAt"]},UpdateAssetInput:{type:"object",properties:{title:{type:"string",minLength:1,maxLength:200,example:"Updated Title"},artist:{type:"string",minLength:1,maxLength:200,example:"Updated Artist"},bpm:{type:"number",minimum:1,example:120},keySig:{type:"string",maxLength:10,example:"C Major"},priceAmount:{type:"number",minimum:0,example:29.99},priceCurrency:{type:"string",minLength:3,maxLength:3,example:"USD"},status:{type:"string",enum:["draft","published","archived","processing","ready","error"],example:"published"}}},ErrorResponse:{type:"object",properties:{error:{type:"string",example:"Asset not found"}},required:["error"]},ValidationErrorResponse:{type:"object",properties:{error:{type:"string",example:"Validation failed"},details:{type:"object",additionalProperties:!0}},required:["error"]},UploadSignInput:{type:"object",properties:{filename:{type:"string",example:"my-beat.mp3",description:"Original filename for the upload"},contentType:{type:"string",example:"audio/mpeg",description:"MIME type (must be audio/*)"},fileSize:{type:"number",example:5242880,description:"File size in bytes (max 100MB = 104857600 bytes)"}},required:["filename","contentType","fileSize"],description:"Request body for /api/upload/sign. Validates file size <= 100MB and audio MIME types only."},UploadNotifyInput:{type:"object",properties:{assetId:{type:"string",example:"beat_001"},key:{type:"string",example:"uploads/beat_001.mp3"},contentType:{type:"string",example:"audio/mpeg"},bytes:{type:"number",example:1024e3}},required:["assetId","key"]},UploadCompleteInput:{type:"object",properties:{assetId:{type:"string",example:"beat_001"},status:{type:"string",enum:["ready","error"],default:"ready",example:"ready"},errorMessage:{type:"string",example:"Processing failed"}},required:["assetId"]},AuditLogEntry:{type:"object",properties:{id:{type:"string",example:"audit-beat_001-1234567890-abc123"},assetId:{type:"string",example:"beat_001"},operation:{type:"string",example:"update"},userId:{type:"string",nullable:!0,example:"user123"},before:{type:"object",nullable:!0},after:{type:"object",nullable:!0},changedFields:{type:"array",items:{type:"string"},example:["title","priceAmount"]},createdAt:{type:"number",example:0x499602d2}},required:["id","assetId","operation","userId","before","after","changedFields","createdAt"]},AuditLogResponse:{type:"object",properties:{assetId:{type:"string",example:"beat_001"},auditLogs:{type:"array",items:{$ref:"#/components/schemas/AuditLogEntry"}},total:{type:"number",example:5}},required:["assetId","auditLogs","total"]}}}};return b.info("OpenAPI spec generated successfully",{endpointCount:Object.keys(a.paths).length,schemaCount:Object.keys(a.components?.schemas||{}).length}),v.NextResponse.json(a,{status:200,headers:{"Content-Type":"application/json","Cache-Control":"public, max-age=300"}})}catch(a){return b.error("Failed to generate OpenAPI spec",a instanceof Error?a:Error(String(a))),v.NextResponse.json({error:"Failed to generate OpenAPI specification",message:a instanceof Error?a.message:"Unknown error"},{status:500})}}let y=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/openapi/route",pathname:"/api/openapi",filename:"route",bundlePath:"app/api/openapi/route"},distDir:".next",relativeProjectDir:"",resolvedPagePath:"/home/runner/work/gotmusic/gotmusic/apps/web/src/app/api/openapi/route.ts",nextConfigOutput:"",userland:d}),{workAsyncStorage:z,workUnitAsyncStorage:A,serverHooks:B}=y;function C(){return(0,g.patchFetch)({workAsyncStorage:z,workUnitAsyncStorage:A})}async function D(a,b,c){var d;let e="/api/openapi/route";"/index"===e&&(e="/");let g=await y.prepare(a,b,{srcPage:e,multiZoneDraftMode:!1});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:z,routerServerContext:A,isOnDemandRevalidate:B,revalidateOnlyGenerated:C,resolvedPathname:D}=g,E=(0,j.normalizeAppPath)(e),F=!!(z.dynamicRoutes[E]||z.routes[D]);if(F&&!x){let a=!!z.routes[D],b=z.dynamicRoutes[E];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let G=null;!F||y.isDev||x||(G="/index"===(G=D)?"/":G);let H=!0===y.isDev||!F,I=F&&!H,J=a.method||"GET",K=(0,i.getTracer)(),L=K.getActiveScopeSpan(),M={params:v,prerenderManifest:z,renderOpts:{experimental:{cacheComponents:!!w.experimental.cacheComponents,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:H,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:I,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>y.onRequestError(a,b,d,A)},sharedContext:{buildId:u}},N=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(N,(0,l.signalFromNodeResponse)(b));try{let d=async c=>y.handle(P,M).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=K.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${J} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${J} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&B&&C&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=M.renderOpts.fetchMetrics;let i=M.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=M.renderOpts.collectedTags;if(!F)return await (0,o.I)(N,O,e,M.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,d=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await y.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:B})},A),b}},l=await y.handleResponse({req:a,nextConfig:w,cacheKey:G,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:z,isRoutePPREnabled:!1,isOnDemandRevalidate:B,revalidateOnlyGenerated:C,responseGenerator:k,waitUntil:c.waitUntil});if(!F)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",B?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&F||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(N,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};L?await g(L):await K.withPropagatedContext(a.headers,()=>K.trace(m.BaseServerSpan.handleRequest,{spanName:`${J} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":J,"http.target":a.url}},g))}catch(b){if(b instanceof s.NoFallbackError||await y.onRequestError(a,b,{routerKind:"App Router",routePath:E,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:B})}),F)throw b;return await (0,o.I)(N,O,new Response(null,{status:500})),null}}},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},80408:()=>{},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},87032:()=>{}};var b=require("../../../webpack-runtime.js");b.C(a);var c=b.X(0,[635,825],()=>b(b.s=46683));module.exports=c})();