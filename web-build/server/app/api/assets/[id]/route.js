(()=>{var a={};a.id=925,a.ids=[925],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},930:(a,b,c)=>{"use strict";c.d(b,{u:()=>e});var d=c(20061);let e=d.Ikc({id:d.YjP(),title:d.YjP(),artist:d.YjP(),bpm:d.aig().nullable(),keySig:d.YjP().nullable(),priceAmount:d.aig(),priceCurrency:d.YjP(),status:d.k5n(["draft","published","archived","processing","ready","error"]),updatedAt:d.aig(),createdAt:d.aig()});d.Ikc({items:d.YOg(e),nextCursor:d.YjP().nullable()})},1183:(a,b,c)=>{"use strict";c.d(b,{IsRestoringProvider:()=>e,useIsRestoring:()=>f});var d=c(25459);let e=(0,d.registerClientReference)(function(){throw Error("Attempted to call IsRestoringProvider() from the server but IsRestoringProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/runner/work/gotmusic/gotmusic/node_modules/@tanstack/react-query/build/modern/IsRestoringProvider.js","IsRestoringProvider"),f=(0,d.registerClientReference)(function(){throw Error("Attempted to call useIsRestoring() from the server but useIsRestoring is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/runner/work/gotmusic/gotmusic/node_modules/@tanstack/react-query/build/modern/IsRestoringProvider.js","useIsRestoring")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5942:(a,b,c)=>{"use strict";c.d(b,{useSuspenseQuery:()=>d});let d=(0,c(25459).registerClientReference)(function(){throw Error("Attempted to call useSuspenseQuery() from the server but useSuspenseQuery is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/runner/work/gotmusic/gotmusic/node_modules/@tanstack/react-query/build/modern/useSuspenseQuery.js","useSuspenseQuery")},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},14216:(a,b,c)=>{"use strict";c.d(b,{h:()=>j});let d=()=>{},e={debug:d,info:d,warn:console.warn.bind(console),error:console.error.bind(console)},{debug:f,info:g,warn:h,error:i}=e;function j(a){let b="";if("string"==typeof a)b=`[${a}]`;else if(a&&"object"==typeof a){let c=[];a.requestId&&c.push(`req:${a.requestId}`),a.method&&c.push(a.method),a.path&&c.push(a.path),b=c.length>0?`[${c.join(" ")}]`:""}return{debug:(...a)=>e.debug(b,...a),info:(...a)=>e.info(b,...a),warn:(...a)=>e.warn(b,...a),error:(...a)=>e.error(b,...a)}}},19121:a=>{"use strict";a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},23833:(a,b,c)=>{"use strict";c.d(b,{HydrationBoundary:()=>j});var d=c(31768),e=c(36836),f=c(99894);function g(a){return a}function h(a,b,c){if("object"!=typeof b||null===b)return;let d=a.getMutationCache(),h=a.getQueryCache(),i=c?.defaultOptions?.deserializeData??a.getDefaultOptions().hydrate?.deserializeData??g,j=b.mutations||[],k=b.queries||[];j.forEach(({state:b,...e})=>{d.build(a,{...a.getDefaultOptions().hydrate?.mutations,...c?.defaultOptions?.mutations,...e},b)}),k.forEach(({queryKey:b,state:d,queryHash:g,meta:j,promise:k,dehydratedAt:l})=>{let m=k?(0,e.b)(k):void 0,n=void 0===d.data?m?.data:d.data,o=void 0===n?n:i(n),p=h.get(g),q=p?.state.status==="pending",r=p?.state.fetchStatus==="fetching";if(p){let a=m&&void 0!==l&&l>p.state.dataUpdatedAt;if(d.dataUpdatedAt>p.state.dataUpdatedAt||a){let{fetchStatus:a,...b}=d;p.setState({...b,data:o})}}else p=h.build(a,{...a.getDefaultOptions().hydrate?.queries,...c?.defaultOptions?.queries,queryKey:b,queryHash:g,meta:j},{...d,data:o,fetchStatus:"idle",status:void 0!==o?"success":d.status});k&&!q&&!r&&(void 0===l||l>p.state.dataUpdatedAt)&&p.fetch(void 0,{initialPromise:Promise.resolve(k).then(i)}).catch(f.lQ)})}var i=c(32315),j=({children:a,options:b={},state:c,queryClient:e})=>{let f=(0,i.useQueryClient)(e),g=d.useRef(b);d.useEffect(()=>{g.current=b});let j=d.useMemo(()=>{if(c){if("object"!=typeof c)return;let a=f.getQueryCache(),b=c.queries||[],d=[],e=[];for(let c of b){let b=a.get(c.queryHash);b?(c.state.dataUpdatedAt>b.state.dataUpdatedAt||c.promise&&"pending"!==b.state.status&&"fetching"!==b.state.fetchStatus&&void 0!==c.dehydratedAt&&c.dehydratedAt>b.state.dataUpdatedAt)&&e.push(c):d.push(c)}if(d.length>0&&h(f,{queries:d},g.current),e.length>0)return e}},[f,c]);return d.useEffect(()=>{j&&h(f,{queries:j},g.current)},[f,j]),a}},23924:(a,b,c)=>{"use strict";c.r(b),c.d(b,{assetAudit:()=>C,assetAuditPg:()=>u,assetAuditRelations:()=>G,assetAuditRelationsPg:()=>y,assetFileKindEnum:()=>p,assetFileRelations:()=>F,assetFileRelationsPg:()=>x,assetFiles:()=>B,assetFilesPg:()=>t,assetRelations:()=>E,assetRelationsPg:()=>w,assetStatusEnum:()=>o,assets:()=>A,assetsPg:()=>s,auditOperationEnum:()=>q,uploadJobRelations:()=>H,uploadJobRelationsPg:()=>z,uploadJobStageEnum:()=>r,uploadJobs:()=>D,uploadJobsPg:()=>v});var d=c(89956),e=c(77988),f=c(92570),g=c(34107),h=c(7268),i=c(51453),j=c(25880),k=c(72099),l=c(34527),m=c(88674),n=c(45254);let o=(0,f.rL)("asset_status",["draft","published","archived","processing","ready","error"]),p=(0,f.rL)("asset_file_kind",["original","preview","artwork","waveform"]),q=(0,f.rL)("audit_operation",["create","update","delete","status_change"]),r=(0,f.rL)("upload_job_stage",["init","uploading","encrypting","done","error"]),s=(0,g.cJ)("assets",{id:(0,h.Qq)("id").primaryKey(),title:(0,h.Qq)("title").notNull(),artist:(0,h.Qq)("artist").notNull(),bpm:(0,i.nd)("bpm"),keySig:(0,h.Qq)("key_sig"),durationSec:(0,i.nd)("duration_sec"),priceAmount:(0,j.sH)("price_amount",{precision:10,scale:2}).notNull(),priceCurrency:(0,h.Qq)("price_currency").notNull(),priceCredits:(0,i.nd)("price_credits").default(10),status:o("status").notNull().default("draft"),fileCid:(0,h.Qq)("file_cid"),storageKey:(0,h.Qq)("storage_key"),ownerId:(0,h.Qq)("owner_id"),updatedAt:(0,k.vE)("updated_at").notNull().defaultNow().$onUpdate(()=>new Date),createdAt:(0,k.vE)("created_at").notNull().defaultNow()},a=>({statusIdx:(0,l.Pe)("assets_status_idx").on(a.status),updatedAtIdx:(0,l.Pe)("assets_updated_at_idx").on(a.updatedAt),artistIdx:(0,l.Pe)("assets_artist_idx").on(a.artist),priceAmountCheck:(0,m.z6)("price_amount_positive",(0,d.ll)`${a.priceAmount} >= 0`)})),t=(0,g.cJ)("asset_files",{id:(0,h.Qq)("id").primaryKey(),assetId:(0,h.Qq)("asset_id").notNull(),kind:p("kind").notNull(),storageKey:(0,h.Qq)("storage_key").notNull(),bytes:(0,i.nd)("bytes"),mime:(0,h.Qq)("mime"),checksum:(0,h.Qq)("checksum"),createdAt:(0,k.vE)("created_at").notNull().defaultNow()},a=>({assetKindUnique:(0,n.Am)("asset_files_asset_id_kind_unique").on(a.assetId,a.kind),assetIdIdx:(0,l.Pe)("asset_files_asset_id_idx").on(a.assetId),kindIdx:(0,l.Pe)("asset_files_kind_idx").on(a.kind)})),u=(0,g.cJ)("asset_audit",{id:(0,h.Qq)("id").primaryKey(),assetId:(0,h.Qq)("asset_id").notNull(),operation:q("operation").notNull(),userId:(0,h.Qq)("user_id"),before:(0,h.Qq)("before"),after:(0,h.Qq)("after"),changedFields:(0,h.Qq)("changed_fields"),createdAt:(0,k.vE)("created_at").notNull().defaultNow()},a=>({assetIdIdx:(0,l.Pe)("asset_audit_asset_id_idx").on(a.assetId),operationIdx:(0,l.Pe)("asset_audit_operation_idx").on(a.operation),createdAtIdx:(0,l.Pe)("asset_audit_created_at_idx").on(a.createdAt)})),v=(0,g.cJ)("upload_jobs",{id:(0,h.Qq)("id").primaryKey(),userId:(0,h.Qq)("user_id").notNull(),assetId:(0,h.Qq)("asset_id").notNull(),stage:r("stage").notNull().default("init"),message:(0,h.Qq)("message"),createdAt:(0,k.vE)("created_at").notNull().defaultNow()},a=>({userIdIdx:(0,l.Pe)("upload_jobs_user_id_idx").on(a.userId),assetIdIdx:(0,l.Pe)("upload_jobs_asset_id_idx").on(a.assetId),stageIdx:(0,l.Pe)("upload_jobs_stage_idx").on(a.stage)})),w=(0,e.K1)(s,({many:a})=>({files:a(t),auditLogs:a(u),uploadJobs:a(v)})),x=(0,e.K1)(t,({one:a})=>({asset:a(s,{fields:[t.assetId],references:[s.id]})})),y=(0,e.K1)(u,({one:a})=>({asset:a(s,{fields:[u.assetId],references:[s.id]})})),z=(0,e.K1)(v,({one:a})=>({asset:a(s,{fields:[v.assetId],references:[s.id]})})),A=s,B=t,C=u,D=v,E=w,F=x,G=y,H=z},24549:(a,b,c)=>{"use strict";c.r(b),c.d(b,{QueryClientContext:()=>e,QueryClientProvider:()=>f,useQueryClient:()=>g});var d=c(25459);let e=(0,d.registerClientReference)(function(){throw Error("Attempted to call QueryClientContext() from the server but QueryClientContext is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/runner/work/gotmusic/gotmusic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js","QueryClientContext"),f=(0,d.registerClientReference)(function(){throw Error("Attempted to call QueryClientProvider() from the server but QueryClientProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/runner/work/gotmusic/gotmusic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js","QueryClientProvider"),g=(0,d.registerClientReference)(function(){throw Error("Attempted to call useQueryClient() from the server but useQueryClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/runner/work/gotmusic/gotmusic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js","useQueryClient")},27314:(a,b,c)=>{"use strict";c.d(b,{useIsMutating:()=>e,useMutationState:()=>f});var d=c(25459);let e=(0,d.registerClientReference)(function(){throw Error("Attempted to call useIsMutating() from the server but useIsMutating is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/runner/work/gotmusic/gotmusic/node_modules/@tanstack/react-query/build/modern/useMutationState.js","useIsMutating"),f=(0,d.registerClientReference)(function(){throw Error("Attempted to call useMutationState() from the server but useMutationState is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/runner/work/gotmusic/gotmusic/node_modules/@tanstack/react-query/build/modern/useMutationState.js","useMutationState")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},32035:(a,b,c)=>{"use strict";c.d(b,{useMutation:()=>d});let d=(0,c(25459).registerClientReference)(function(){throw Error("Attempted to call useMutation() from the server but useMutation is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/runner/work/gotmusic/gotmusic/node_modules/@tanstack/react-query/build/modern/useMutation.js","useMutation")},36954:(a,b,c)=>{"use strict";c.d(b,{useSuspenseInfiniteQuery:()=>d});let d=(0,c(25459).registerClientReference)(function(){throw Error("Attempted to call useSuspenseInfiniteQuery() from the server but useSuspenseInfiniteQuery is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/runner/work/gotmusic/gotmusic/node_modules/@tanstack/react-query/build/modern/useSuspenseInfiniteQuery.js","useSuspenseInfiniteQuery")},38796:(a,b,c)=>{"use strict";c.d(b,{useIsFetching:()=>d});let d=(0,c(25459).registerClientReference)(function(){throw Error("Attempted to call useIsFetching() from the server but useIsFetching is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/runner/work/gotmusic/gotmusic/node_modules/@tanstack/react-query/build/modern/useIsFetching.js","useIsFetching")},39589:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.d(b,{db:()=>j});var e=c(94560),f=c(64939),g=c(23924),h=a([f,e]);[f,e]=h.then?(await h)():h;let i=null,j=new Proxy({},{get:(a,b)=>(!i&&(i=function(){let a=process.env.DATABASE_URL;if(!a)throw Error("DATABASE_URL environment variable is required for Postgres");let b=new f.Pool({connectionString:a,ssl:!process.env.CI&&!process.env.E2E_AUTH_BYPASS&&{rejectUnauthorized:!1}});return(0,e.fd)(b,{schema:g})}()),i)[b]});d()}catch(a){d(a)}})},42852:(a,b,c)=>{Promise.resolve().then(c.bind(c,23833)),Promise.resolve().then(c.bind(c,61285)),Promise.resolve().then(c.bind(c,32315)),Promise.resolve().then(c.bind(c,56826)),Promise.resolve().then(c.bind(c,54748)),Promise.resolve().then(c.bind(c,56486)),Promise.resolve().then(c.bind(c,50292)),Promise.resolve().then(c.bind(c,59992)),Promise.resolve().then(c.bind(c,79161)),Promise.resolve().then(c.bind(c,27380)),Promise.resolve().then(c.bind(c,79356)),Promise.resolve().then(c.bind(c,78612)),Promise.resolve().then(c.bind(c,52852))},43654:(a,b,c)=>{"use strict";c.d(b,{useQuery:()=>d});let d=(0,c(25459).registerClientReference)(function(){throw Error("Attempted to call useQuery() from the server but useQuery is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/runner/work/gotmusic/gotmusic/node_modules/@tanstack/react-query/build/modern/useQuery.js","useQuery")},44870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},46452:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.d(b,{z:()=>j});var e=c(14216),f=c(88745),g=c(84139),h=a([g]);async function i(a){let b=(0,e.h)(),c=(0,f.$C)();try{await g.db.insert(g.w.assetAudit).values({id:c,assetId:a.assetId,operation:a.operation,userId:a.userId??null,before:a.before?JSON.stringify(a.before):null,after:a.after?JSON.stringify(a.after):null,changedFields:a.changedFields?JSON.stringify(a.changedFields):null}),b.info("Audit entry written",{auditId:c,assetId:a.assetId,operation:a.operation,changedFields:a.changedFields,userId:a.userId})}catch(d){throw b.error("Failed to write audit entry",d instanceof Error?d:Error(String(d)),{auditId:c,assetId:a.assetId,operation:a.operation}),d}}async function j(a,b,c,d){let e=[];for(let a of new Set([...Object.keys(b),...Object.keys(c)]))b[a]!==c[a]&&e.push(a);let f=e.includes("status")?"status_change":"update";await i({assetId:a,operation:f,userId:d,before:b,after:c,changedFields:e})}g=(h.then?(await h)():h)[0],d()}catch(a){d(a)}})},47063:(a,b,c)=>{"use strict";c.d(b,{HydrationBoundary:()=>d});let d=(0,c(25459).registerClientReference)(function(){throw Error("Attempted to call HydrationBoundary() from the server but HydrationBoundary is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/runner/work/gotmusic/gotmusic/node_modules/@tanstack/react-query/build/modern/HydrationBoundary.js","HydrationBoundary")},51204:(a,b,c)=>{"use strict";c.d(b,{QueryErrorResetBoundary:()=>e,useQueryErrorResetBoundary:()=>f});var d=c(25459);let e=(0,d.registerClientReference)(function(){throw Error("Attempted to call QueryErrorResetBoundary() from the server but QueryErrorResetBoundary is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/runner/work/gotmusic/gotmusic/node_modules/@tanstack/react-query/build/modern/QueryErrorResetBoundary.js","QueryErrorResetBoundary"),f=(0,d.registerClientReference)(function(){throw Error("Attempted to call useQueryErrorResetBoundary() from the server but useQueryErrorResetBoundary is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/runner/work/gotmusic/gotmusic/node_modules/@tanstack/react-query/build/modern/QueryErrorResetBoundary.js","useQueryErrorResetBoundary")},51706:(a,b,c)=>{"use strict";c.d(b,{useQueries:()=>d});let d=(0,c(25459).registerClientReference)(function(){throw Error("Attempted to call useQueries() from the server but useQueries is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/runner/work/gotmusic/gotmusic/node_modules/@tanstack/react-query/build/modern/useQueries.js","useQueries")},52852:(a,b,c)=>{"use strict";c.d(b,{useSuspenseQuery:()=>g});var d=c(69029),e=c(32819),f=c(54309);function g(a,b){return(0,e.t)({...a,enabled:!0,suspense:!0,throwOnError:f.R3,placeholderData:void 0},d.$,b)}},54748:(a,b,c)=>{"use strict";c.d(b,{useInfiniteQuery:()=>f});var d=c(57605),e=c(32819);function f(a,b){return(0,e.t)(a,d.z,b)}},56486:(a,b,c)=>{"use strict";c.d(b,{useIsFetching:()=>g});var d=c(31768),e=c(89287),f=c(32315);function g(a,b){let c=(0,f.useQueryClient)(b),g=c.getQueryCache();return d.useSyncExternalStore(d.useCallback(a=>g.subscribe(e.jG.batchCalls(a)),[g]),()=>c.isFetching(a),()=>c.isFetching(a))}},57605:(a,b,c)=>{"use strict";c.d(b,{z:()=>f});var d=c(69029),e=c(93069),f=class extends d.${constructor(a,b){super(a,b)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(a){super.setOptions({...a,behavior:(0,e.PL)()})}getOptimisticResult(a){return a.behavior=(0,e.PL)(),super.getOptimisticResult(a)}fetchNextPage(a){return this.fetch({...a,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(a){return this.fetch({...a,meta:{fetchMore:{direction:"backward"}}})}createResult(a,b){let{state:c}=a,d=super.createResult(a,b),{isFetching:f,isRefetching:g,isError:h,isRefetchError:i}=d,j=c.fetchMeta?.fetchMore?.direction,k=h&&"forward"===j,l=f&&"forward"===j,m=h&&"backward"===j,n=f&&"backward"===j;return{...d,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:(0,e.rB)(b,c.data),hasPreviousPage:(0,e.RQ)(b,c.data),isFetchNextPageError:k,isFetchingNextPage:l,isFetchPreviousPageError:m,isFetchingPreviousPage:n,isRefetchError:i&&!k&&!m,isRefetching:g&&!l&&!n}}}},59992:(a,b,c)=>{"use strict";c.d(b,{useIsMutating:()=>h,useMutationState:()=>j});var d=c(31768),e=c(99894),f=c(89287),g=c(32315);function h(a,b){let c=(0,g.useQueryClient)(b);return j({filters:{...a,status:"pending"}},c).length}function i(a,b){return a.findAll(b.filters).map(a=>b.select?b.select(a):a.state)}function j(a={},b){let c=(0,g.useQueryClient)(b).getMutationCache(),h=d.useRef(a),k=d.useRef(null);return null===k.current&&(k.current=i(c,a)),d.useEffect(()=>{h.current=a}),d.useSyncExternalStore(d.useCallback(a=>c.subscribe(()=>{let b=(0,e.BH)(k.current,i(c,h.current));k.current!==b&&(k.current=b,f.jG.schedule(a))}),[c]),()=>k.current,()=>k.current)}},62074:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{handler:()=>x,patchFetch:()=>w,routeModule:()=>y,serverHooks:()=>B,workAsyncStorage:()=>z,workUnitAsyncStorage:()=>A});var e=c(26421),f=c(97714),g=c(85681),h=c(22369),i=c(37587),j=c(261),k=c(46537),l=c(3463),m=c(1889),n=c(85250),o=c(23620),p=c(29790),q=c(67876),r=c(57749),s=c(86439),t=c(40139),u=c(73834),v=a([u]);u=(v.then?(await v)():v)[0];let y=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/assets/[id]/route",pathname:"/api/assets/[id]",filename:"route",bundlePath:"app/api/assets/[id]/route"},distDir:".next",relativeProjectDir:"",resolvedPagePath:"/home/runner/work/gotmusic/gotmusic/apps/web/src/app/api/assets/[id]/route.ts",nextConfigOutput:"",userland:u}),{workAsyncStorage:z,workUnitAsyncStorage:A,serverHooks:B}=y;function w(){return(0,g.patchFetch)({workAsyncStorage:z,workUnitAsyncStorage:A})}async function x(a,b,c){var d;let e="/api/assets/[id]/route";"/index"===e&&(e="/");let g=await y.prepare(a,b,{srcPage:e,multiZoneDraftMode:!1});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:z,routerServerContext:A,isOnDemandRevalidate:B,revalidateOnlyGenerated:C,resolvedPathname:D}=g,E=(0,j.normalizeAppPath)(e),F=!!(z.dynamicRoutes[E]||z.routes[D]);if(F&&!x){let a=!!z.routes[D],b=z.dynamicRoutes[E];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let G=null;!F||y.isDev||x||(G=D,G="/index"===G?"/":G);let H=!0===y.isDev||!F,I=F&&!H,J=a.method||"GET",K=(0,i.getTracer)(),L=K.getActiveScopeSpan(),M={params:v,prerenderManifest:z,renderOpts:{experimental:{cacheComponents:!!w.experimental.cacheComponents,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:H,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:I,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>y.onRequestError(a,b,d,A)},sharedContext:{buildId:u}},N=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(N,(0,l.signalFromNodeResponse)(b));try{let d=async c=>y.handle(P,M).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=K.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${J} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${J} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&B&&C&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=M.renderOpts.fetchMetrics;let i=M.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=M.renderOpts.collectedTags;if(!F)return await (0,o.I)(N,O,e,M.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,d=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await y.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:B})},A),b}},l=await y.handleResponse({req:a,nextConfig:w,cacheKey:G,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:z,isRoutePPREnabled:!1,isOnDemandRevalidate:B,revalidateOnlyGenerated:C,responseGenerator:k,waitUntil:c.waitUntil});if(!F)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",B?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&F||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(N,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};L?await g(L):await K.withPropagatedContext(a.headers,()=>K.trace(m.BaseServerSpan.handleRequest,{spanName:`${J} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":J,"http.target":a.url}},g))}catch(b){if(b instanceof s.NoFallbackError||await y.onRequestError(a,b,{routerKind:"App Router",routePath:E,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:B})}),F)throw b;return await (0,o.I)(N,O,new Response(null,{status:500})),null}}d()}catch(a){d(a)}})},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},63146:(a,b,c)=>{"use strict";c.d(b,{useInfiniteQuery:()=>d});let d=(0,c(25459).registerClientReference)(function(){throw Error("Attempted to call useInfiniteQuery() from the server but useInfiniteQuery is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/runner/work/gotmusic/gotmusic/node_modules/@tanstack/react-query/build/modern/useInfiniteQuery.js","useInfiniteQuery")},64939:a=>{"use strict";a.exports=import("pg")},73834:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{GET:()=>m,PATCH:()=>n,runtime:()=>o});var e=c(14216),f=c(84139),g=c(46452),h=c(930),i=c(81796),j=c(53444),k=c(20061),l=a([f,g]);[f,g]=l.then?(await l)():l;let o="nodejs",p=a=>{if(a instanceof Date)return a.getTime();if("number"==typeof a)return a;if("string"==typeof a){let b=Date.parse(a);return Number.isNaN(b)?Date.now():b}return Date.now()},q=a=>{if("number"==typeof a)return a;if("string"==typeof a){let b=Number.parseFloat(a);return Number.isNaN(b)?0:b}return 0},r=k.Ikc({title:k.YjP().min(1).max(200).optional(),artist:k.YjP().min(1).max(200).optional(),bpm:k.aig().int().positive().optional(),keySig:k.YjP().max(10).optional(),priceAmount:k.aig().positive().optional(),priceCurrency:k.YjP().length(3).optional(),status:k.k5n(["draft","published","archived","processing","ready","error"]).optional()}),s=new Map;async function m(a,{params:b}){let c=(0,e.h)();try{let{id:a}=await b;c.info("Asset fetch requested",{assetId:a});let d=await f.db.select().from(f.w.assets).where((0,i.eq)(f.w.assets.id,a)).then(a=>a[0]);if(!d)return c.warn("Asset not found",{assetId:a}),j.NextResponse.json({error:"Asset not found"},{status:404});let e={id:d.id,title:d.title,artist:d.artist,bpm:d.bpm,keySig:d.keySig,priceAmount:q(d.priceAmount),priceCurrency:d.priceCurrency,status:d.status,updatedAt:p(d.updatedAt),createdAt:p(d.createdAt)},g=h.u.parse(e);return c.info("Asset fetched successfully",{assetId:a}),j.NextResponse.json(g)}catch(d){if(d&&"object"==typeof d&&"name"in d&&"ZodError"===d.name)return c.error("Asset validation error",d instanceof Error?d:Error(String(d)),{assetId:(await b).id}),j.NextResponse.json({error:"Invalid asset data format"},{status:500});let a=d instanceof Error?d.message:"Failed to fetch asset";return c.error("Asset fetch failed",d instanceof Error?d:Error(String(d)),{assetId:(await b).id}),j.NextResponse.json({error:a},{status:500})}}async function n(a,{params:b}){let c=(0,e.h)();try{let{id:d}=await b;c.info("Asset update requested",{assetId:d});let e=a.headers.get("idempotency-key");if(!e)return c.warn("Missing idempotency key",{assetId:d}),j.NextResponse.json({error:"Idempotency-Key header is required"},{status:400});let k=s.get(e);if(k){if(Date.now()-k.timestamp<864e5)return c.info("Idempotent request, returning cached response",{assetId:d,idempotencyKey:e}),j.NextResponse.json(k.response);s.delete(e)}let l=await f.db.select().from(f.w.assets).where((0,i.eq)(f.w.assets.id,d)).then(a=>a[0]);if(!l)return c.warn("Asset not found for update",{assetId:d}),j.NextResponse.json({error:"Asset not found"},{status:404});let m=await a.json().catch(()=>({})),n=r.safeParse(m);if(!n.success)return c.warn("Validation failed",{assetId:d,validationErrors:n.error.format()}),j.NextResponse.json({error:"Validation failed",details:n.error.format()},{status:422});let o=n.data;if(0===Object.keys(o).length)return c.warn("No valid fields to update",{assetId:d}),j.NextResponse.json({error:"No valid fields to update"},{status:400});c.info("Updating asset",{assetId:d,updates:o});let t={...o};void 0!==t.priceAmount&&null!==t.priceAmount&&(t.priceAmount=t.priceAmount.toString()),await f.db.update(f.w.assets).set({...t,updatedAt:new Date}).where((0,i.eq)(f.w.assets.id,d));let u=await f.db.select().from(f.w.assets).where((0,i.eq)(f.w.assets.id,d)).then(a=>a[0]);if(u&&(c.info("Writing audit entry",{assetId:d,changedFields:Object.keys(o)}),await (0,g.z)(d,l,u,void 0)),!u)return c.error("Failed to retrieve updated asset",Error("Asset not found after update"),{assetId:d}),j.NextResponse.json({error:"Failed to retrieve updated asset"},{status:500});let v={id:u.id,title:u.title,artist:u.artist,bpm:u.bpm,keySig:u.keySig,priceAmount:q(u.priceAmount),priceCurrency:u.priceCurrency,status:u.status,updatedAt:p(u.updatedAt),createdAt:p(u.createdAt)},w=h.u.parse(v);for(let[a,b]of(s.set(e,{response:w,timestamp:Date.now()}),s.entries()))Date.now()-b.timestamp>864e5&&s.delete(a);return c.info("Asset updated successfully",{assetId:d,changedFields:Object.keys(o)}),j.NextResponse.json(w)}catch(d){if(d&&"object"==typeof d&&"name"in d&&"ZodError"===d.name)return c.error("Asset validation error",d instanceof Error?d:Error(String(d)),{assetId:(await b).id}),j.NextResponse.json({error:"Invalid asset data format"},{status:422});let a=d instanceof Error?d.message:"Failed to update asset";return c.error("Asset update failed",d instanceof Error?d:Error(String(d)),{assetId:(await b).id}),j.NextResponse.json({error:a},{status:500})}}d()}catch(a){d(a)}})},77598:a=>{"use strict";a.exports=require("node:crypto")},78612:(a,b,c)=>{"use strict";c.d(b,{useSuspenseQueries:()=>f});var d=c(79161),e=c(54309);function f(a,b){return(0,d.useQueries)({...a,queries:a.queries.map(a=>({...a,suspense:!0,throwOnError:e.R3,enabled:!0,placeholderData:void 0}))},b)}},79161:(a,b,c)=>{"use strict";c.d(b,{useQueries:()=>p});var d=c(31768),e=c(89287),f=c(69029),g=c(33750),h=c(99894);function i(a,b){let c=new Set(b);return a.filter(a=>!c.has(a))}var j=class extends g.Q{#a;#b;#c;#d;#e;#f;#g;#h;#i=[];constructor(a,b,c){super(),this.#a=a,this.#d=c,this.#c=[],this.#e=[],this.#b=[],this.setQueries(b)}onSubscribe(){1===this.listeners.size&&this.#e.forEach(a=>{a.subscribe(b=>{this.#j(a,b)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,this.#e.forEach(a=>{a.destroy()})}setQueries(a,b){this.#c=a,this.#d=b,e.jG.batch(()=>{let a=this.#e,b=this.#k(this.#c);this.#i=b,b.forEach(a=>a.observer.setOptions(a.defaultedQueryOptions));let c=b.map(a=>a.observer),d=c.map(a=>a.getCurrentResult()),e=a.length!==c.length,f=c.some((b,c)=>b!==a[c]),g=e||f,j=!!g||d.some((a,b)=>{let c=this.#b[b];return!c||!(0,h.f8)(a,c)});(g||j)&&(g&&(this.#e=c),this.#b=d,this.hasListeners()&&(g&&(i(a,c).forEach(a=>{a.destroy()}),i(c,a).forEach(a=>{a.subscribe(b=>{this.#j(a,b)})})),this.#l()))})}getCurrentResult(){return this.#b}getQueries(){return this.#e.map(a=>a.getCurrentQuery())}getObservers(){return this.#e}getOptimisticResult(a,b){let c=this.#k(a),d=c.map(a=>a.observer.getOptimisticResult(a.defaultedQueryOptions));return[d,a=>this.#m(a??d,b),()=>this.#n(d,c)]}#n(a,b){return b.map((c,d)=>{let e=a[d];return c.defaultedQueryOptions.notifyOnChangeProps?e:c.observer.trackResult(e,a=>{b.forEach(b=>{b.observer.trackProp(a)})})})}#m(a,b){return b?(this.#f&&this.#b===this.#h&&b===this.#g||(this.#g=b,this.#h=this.#b,this.#f=(0,h.BH)(this.#f,b(a))),this.#f):a}#k(a){let b=new Map(this.#e.map(a=>[a.options.queryHash,a])),c=[];return a.forEach(a=>{let d=this.#a.defaultQueryOptions(a),e=b.get(d.queryHash);e?c.push({defaultedQueryOptions:d,observer:e}):c.push({defaultedQueryOptions:d,observer:new f.$(this.#a,d)})}),c}#j(a,b){let c=this.#e.indexOf(a);-1!==c&&(this.#b=function(a,b,c){let d=a.slice(0);return d[b]=c,d}(this.#b,c,b),this.#l())}#l(){if(this.hasListeners()){let a=this.#f,b=this.#n(this.#b,this.#i);a!==this.#m(b,this.#d?.combine)&&e.jG.batch(()=>{this.listeners.forEach(a=>{a(this.#b)})})}}},k=c(32315),l=c(61285),m=c(56826),n=c(68168),o=c(54309);function p({queries:a,...b},c){let g=(0,k.useQueryClient)(c),i=(0,l.useIsRestoring)(),p=(0,m.useQueryErrorResetBoundary)(),q=d.useMemo(()=>a.map(a=>{let b=g.defaultQueryOptions(a);return b._optimisticResults=i?"isRestoring":"optimistic",b}),[a,g,i]);q.forEach(a=>{(0,o.jv)(a),(0,n.LJ)(a,p)}),(0,n.wZ)(p);let[r]=d.useState(()=>new j(g,q,b)),[s,t,u]=r.getOptimisticResult(q,b.combine),v=!i&&!1!==b.subscribed;d.useSyncExternalStore(d.useCallback(a=>v?r.subscribe(e.jG.batchCalls(a)):h.lQ,[r,v]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),d.useEffect(()=>{r.setQueries(q,b)},[q,b,r]);let w=s.some((a,b)=>(0,o.EU)(q[b],a))?s.flatMap((a,b)=>{let c=q[b];if(c){let b=new f.$(g,c);if((0,o.EU)(c,a))return(0,o.iL)(c,b,p);(0,o.nE)(a,i)&&(0,o.iL)(c,b,p)}return[]}):[];if(w.length>0)throw Promise.all(w);let x=s.find((a,b)=>{let c=q[b];return c&&(0,n.$1)({result:a,errorResetBoundary:p,throwOnError:c.throwOnError,query:g.getQueryCache().get(c.queryHash),suspense:c.suspense})});if(x?.error)throw x.error;return t(u())}},79356:(a,b,c)=>{"use strict";c.d(b,{useSuspenseInfiniteQuery:()=>g});var d=c(57605),e=c(32819),f=c(54309);function g(a,b){return(0,e.t)({...a,enabled:!0,suspense:!0,throwOnError:f.R3},d.z,b)}},84139:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.d(b,{db:()=>e.db,w:()=>f});var e=c(39589),f=c(23924),g=a([e]);e=(g.then?(await g)():g)[0],d()}catch(a){d(a)}})},86218:(a,b,c)=>{"use strict";c.d(b,{useSuspenseQueries:()=>d});let d=(0,c(25459).registerClientReference)(function(){throw Error("Attempted to call useSuspenseQueries() from the server but useSuspenseQueries is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/runner/work/gotmusic/gotmusic/node_modules/@tanstack/react-query/build/modern/useSuspenseQueries.js","useSuspenseQueries")},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},88745:(a,b,c)=>{"use strict";c.d(b,{$C:()=>h});var d,e=c(77598);let f="0123456789ABCDEFGHJKMNPQRSTVWXYZ";!function(a){a.Base32IncorrectEncoding="B32_ENC_INVALID",a.DecodeTimeInvalidCharacter="DEC_TIME_CHAR",a.DecodeTimeValueMalformed="DEC_TIME_MALFORMED",a.EncodeTimeNegative="ENC_TIME_NEG",a.EncodeTimeSizeExceeded="ENC_TIME_SIZE_EXCEED",a.EncodeTimeValueMalformed="ENC_TIME_MALFORMED",a.PRNGDetectFailure="PRNG_DETECT",a.ULIDInvalid="ULID_INVALID",a.Unexpected="UNEXPECTED",a.UUIDInvalid="UUID_INVALID"}(d||(d={}));class g extends Error{constructor(a,b){super(`${b} (${a})`),this.name="ULIDError",this.code=a}}function h(){return function(a,b){let c=function(a){let b="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:null,c=b&&(b.crypto||b.msCrypto)||(void 0!==e?e:null);if("function"==typeof c?.getRandomValues)return()=>{let a=new Uint8Array(1);return c.getRandomValues(a),a[0]/255};if("function"==typeof c?.randomBytes)return()=>c.randomBytes(1).readUInt8()/255;if(e?.randomBytes)return()=>e.randomBytes(1).readUInt8()/255;throw new g(d.PRNGDetectFailure,"Failed to find a reliable PRNG")}();return function(a,b=10){if(isNaN(a))throw new g(d.EncodeTimeValueMalformed,`Time must be a number: ${a}`);if(a>0xffffffffffff)throw new g(d.EncodeTimeSizeExceeded,`Cannot encode a time larger than 281474976710655: ${a}`);if(a<0)throw new g(d.EncodeTimeNegative,`Time must be positive: ${a}`);if(!1===Number.isInteger(a))throw new g(d.EncodeTimeValueMalformed,`Time must be an integer: ${a}`);let c,e="";for(let d=b;d>0;d--)c=a%32,e=f.charAt(c)+e,a=(a-c)/32;return e}(Date.now(),10)+function(a,b){let c="";for(;a>0;a--)c=function(a){let b=Math.floor(32*a())%32;return f.charAt(b)}(b)+c;return c}(16,c)}()}},89700:(a,b,c)=>{Promise.resolve().then(c.bind(c,47063)),Promise.resolve().then(c.bind(c,1183)),Promise.resolve().then(c.bind(c,24549)),Promise.resolve().then(c.bind(c,51204)),Promise.resolve().then(c.bind(c,63146)),Promise.resolve().then(c.bind(c,38796)),Promise.resolve().then(c.bind(c,32035)),Promise.resolve().then(c.bind(c,27314)),Promise.resolve().then(c.bind(c,51706)),Promise.resolve().then(c.bind(c,43654)),Promise.resolve().then(c.bind(c,36954)),Promise.resolve().then(c.bind(c,86218)),Promise.resolve().then(c.bind(c,5942))}};var b=require("../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[635,825,612,61,835,325],()=>b(b.s=62074));module.exports=c})();